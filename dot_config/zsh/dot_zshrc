# Useful aliases
alias grep='command grep ${grepflags[@]}'
alias ls='command ls ${lsflags[@]}'
alias ll='command ls ${lsflags[@]} -lh'
alias la='command ls ${lsflags[@]} -a'
# Quick case-insensitive partial filename search
alias li='command ls ${lsflags[@]} -la | command grep ${grepflags[@]} -i' 2>/dev/null

# Simple tree implementation for macOS
tree() {
	if [[ "$OSTYPE" == "linux-gnu" ]]; then
		command tree "$@"
		return
	fi

	autoload -Uz colors && colors
	local tree_path=${1:-.}

	find -s "$tree_path" -print | sed 's/[^/]*\//|   /g; s/|   $/`-- /g' | while read -r line; do
		if [[ "$line" == */ ]]; then
			echo "${fg[blue]}$line${reset_color}"
		else
			echo "$line"
		fi
	done
}

# Colourful less
man() {
	env \
		LESS_TERMCAP_mb=$(printf "\e[1;31m") \
		LESS_TERMCAP_md=$(printf "\e[1;31m") \
		LESS_TERMCAP_me=$(printf "\e[0m") \
		LESS_TERMCAP_se=$(printf "\e[0m") \
		LESS_TERMCAP_so=$(printf "\e[1;44;33m") \
		LESS_TERMCAP_ue=$(printf "\e[0m") \
		LESS_TERMCAP_us=$(printf "\e[1;32m") \
		man "$@"
}

# No Clobber
setopt NO_CLOBBER

# History
HISTFILE=${XDG_STATE_HOME:-$HOME/.local/state}/zsh/zsh_history
HISTSIZE=2000
SAVEHIST=1000
setopt EXTENDED_HISTORY
setopt SHARE_HISTORY
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_SAVE_NO_DUPS
setopt INC_APPEND_HISTORY
setopt HIST_REDUCE_BLANKS
setopt HIST_NO_STORE
setopt HIST_FIND_NO_DUPS
setopt HIST_EXPIRE_DUPS_FIRST

# Less history
export LESSHISTFILE=${XDG_STATE_HOME:-$HOME/.local/state}/less/lesshst

# Emacs keybinds
bindkey -e
# Search history with up and down keys
bindkey "\e[A" history-beginning-search-backward
bindkey "\e[B" history-beginning-search-forward

# Colours
autoload -Uz colors && colors

# Completions
zstyle ':completion:*:*:*:*:corrections' format '%F{yellow}!- %d (errors: %e) -!%f'
zstyle ':completion:*:messages' format ' %F{purple} -- %d --%f'
zstyle ':completion:*:warnings' format ' %F{red}-- no matches found --%f'
zstyle ':completion:*:sudo:*' command-path /usr/local/sbin /usr/local/bin \
                             /usr/sbin /usr/bin /sbin /bin /usr/X11R6/bin
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
zstyle ':completion:*' matcher-list '' 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=*' 'l:|=* r:|=*'
zstyle ':completion:*' completer _extensions _complete _approximate
zstyle ':completion:*:ls:*' file-patterns '*(/):directories'
zstyle ':completion:*:cd:*' file-patterns '*(/):directories'
zstyle ':completion:*:*:kill:*:processes' list-colors "=(#b) #([0-9]#)*=36=31"
zstyle ':completion:*' menu select
setopt extendedglob
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ${XDG_STATE_HOME:-$HOME/.local/state}/zsh
zmodload zsh/complist
autoload -Uz compinit && compinit -d ${XDG_STATE_HOME:-$HOME/.local/state}/zsh/.zcompdump

# Simple coloured git enabled prompt
source $ZDOTDIR/plugins/zsh-git-prompt/git-prompt.plugin.zsh

ZSH_GIT_PROMPT_FORCE_BLANK=1
ZSH_GIT_PROMPT_SHOW_STASH=1
ZSH_GIT_PROMPT_SHOW_UPSTREAM="no"
ZSH_GIT_PROMPT_SHOW_TRACKING_COUNTS=0
ZSH_GIT_PROMPT_SHOW_LOCAL_COUNTS=0

ZSH_THEME_GIT_PROMPT_PREFIX=" %F{yellow}["
ZSH_THEME_GIT_PROMPT_SUFFIX="%F{yellow}]"
ZSH_THEME_GIT_PROMPT_SEPARATOR=" "
ZSH_THEME_GIT_PROMPT_DETACHED="%B%F{cyan}:%b"
ZSH_THEME_GIT_PROMPT_BRANCH="%B%F{magenta}"
ZSH_THEME_GIT_PROMPT_UPSTREAM_SYMBOL="%B%F{yellow}⟳ %b"
ZSH_THEME_GIT_PROMPT_UPSTREAM_PREFIX="%F{red}(%F{yellow}"
ZSH_THEME_GIT_PROMPT_UPSTREAM_SUFFIX="%F{red})"
ZSH_THEME_GIT_PROMPT_BEHIND="↓"
ZSH_THEME_GIT_PROMPT_AHEAD="↑"
ZSH_THEME_GIT_PROMPT_UNMERGED="%B%F{cyan}●%b"
ZSH_THEME_GIT_PROMPT_STAGED="%B%F{green}●%b"
ZSH_THEME_GIT_PROMPT_UNSTAGED="%B%F{yellow}●%b"
ZSH_THEME_GIT_PROMPT_UNTRACKED="%B%F{red}●%b"
ZSH_THEME_GIT_PROMPT_STASHED="%F{blue}⚑"
ZSH_THEME_GIT_PROMPT_CLEAN=""

# User/Hostname
PROMPT='%(!.%F{red}.%F{blue})%B%n%b '
# Dir/Source Control
PROMPT+='%F{green}%~$(gitprompt) %(?.%f.%F{red})>%f '
RPROMPT=''

# Autosuggestions and syntax highlighting
source $ZDOTDIR/plugins/zsh-autosuggestions/zsh-autosuggestions.plugin.zsh
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=246"
ZSH_AUTOSUGGEST_STRATEGY=(history completion)
source $ZDOTDIR/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.plugin.zsh
